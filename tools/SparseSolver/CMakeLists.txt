# Include this directory
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR})

# Numerics package.
IF (DEFINED ENV{SUITESPARSE_LIB})
    #LINK_DIRECTORIES(/home/qz263/Research/lib)
    LINK_DIRECTORIES($ENV{SUITESPARSE_LIB})
    INCLUDE_DIRECTORIES($ENV{SUITESPARSE_INC})
    SET(UMFPACK_LIBRARIES amd camd colamd ccolamd umfpack
        ufconfig)
    SET(CHOLMOD_LIBRARIES cholmod metis)
ELSE (DEFINED ENV{SUITESPARSE_LIB})
    FIND_PACKAGE("Umfpack")
    FIND_PACKAGE("Cholmod")
    INCLUDE_DIRECTORIES(${UMFPACK_INCLUDES})
ENDIF (DEFINED ENV{SUITESPARSE_LIB})

# Enumerate source files
FILE(GLOB_RECURSE SRC_FILES *.cpp)
FILE(GLOB_RECURSE INC_FILES *.h *.hh)

ADD_LIBRARY(lib_SparseSolver SHARED ${SRC_FILES} ${INC_FILES})
SET_TARGET_PROPERTIES(lib_SparseSolver PROPERTIES OUTPUT_NAME "SparseSolver")
TARGET_LINK_LIBRARIES(lib_SparseSolver Mesh
    ${UMFPACK_LIBRARIES} ${CHOLMOD_LIBRARIES})

set(SWG_FILES PySparseSolver.i)

# Generate wrapper for python
SET_SOURCE_FILES_PROPERTIES(${SWG_FILES} PROPERTIES CPLUSPLUS ON)
SET_SOURCE_FILES_PROPERTIES(${SWG_FILES} PROPERTIES CMAKE_SWIG_FLAGS "-includeall")
SWIG_ADD_MODULE(PySparseSolver python ${SWG_FILES} ${INC_FILES})
SWIG_LINK_LIBRARIES(PySparseSolver ${PYTHON_LIBRARIES} lib_SparseSolver Mesh)

# Boudle lib, swig wrapper into a single target.
# Usage: make SparseSolver
ADD_CUSTOM_TARGET(SparseSolver DEPENDS lib_SparseSolver _PySparseSolver)
